#!/usr/bin/make -f

include /usr/share/dpkg/pkg-info.mk

export DEB_VERSION DEB_VERSION_UPSTREAM
export BUILD_MODE=release-deb
%:
	dh $@ --buildsystem cargo --with=bash-completion

override_dh_auto_test:
	# skip for now to avoid additional debug builds - no tests anyway
	# dh_auto_test -- test --all

override_dh_auto_install:
	DESTDIR=debian/proxmox-offline-mirror dh_auto_install
	DESTDIR=../debian/proxmox-offline-mirror-docs make -C docs install
	rm debian/proxmox-offline-mirror/usr/bin/docgen
	mkdir -p debian/proxmox-offline-mirror-helper/usr/bin
	mv debian/proxmox-offline-mirror/usr/bin/proxmox-offline-mirror-helper \
	 debian/proxmox-offline-mirror-helper/usr/bin

override_dh_missing:
	dh_missing --fail-missing

override_dh_compress:
	dh_compress -X.pdf
